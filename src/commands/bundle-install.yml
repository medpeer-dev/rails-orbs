parameters:
  key:
    type: string
    default: "gems-v1"
  default_branch:
    type: string
    default: "master"
  bundle_path:
    type: string
    default: "vendor/bundle"

steps:
  - restore_cache:
      keys:
        - << parameters.key >>-{{ arch }}-{{ .Branch }}-{{ checksum "Gemfile.lock" }}
        - << parameters.key >>-{{ arch }}-{{ .Branch }}
        - << parameters.key >>-{{ arch }}-<< parameters.default_branch >>
        - << parameters.key >>-{{ arch }}
  - run: bundle config set path << parameters.bundle_path >>
  - run: bundle install --jobs=4 --clean
  - save_cache:
      key: << parameters.key >>-{{ arch }}-{{ .Branch }}-{{ checksum "Gemfile.lock" }}
      paths:
        - << parameters.bundle_path >>
